{%- comment -%}
----------------------------------------------------------------------------------------------------------------------
CURRENCY SELECTOR COMPONENT
----------------------------------------------------------------------------------------------------------------------

This component renders a selector for currencies available in the store's markets.
Shows only currencies without country information.

********************************************
Supported variables
********************************************

* id_prefix: an option to help dissociate the ID in case this is included several times in the same section
* placement: popover placement (default: 'bottom-start')
{%- endcomment -%}

{%- capture currency_form_id -%}currency-form-{{ id_prefix }}-{{ section.id }}{%- endcapture -%}
{%- capture currency_popover_id -%}popover-currency-{{ id_prefix }}-{{ section.id }}{%- endcapture -%}

{%- comment -%}
----------------------------------------------------------------------------------------------------------------------
Get available currencies from all active markets
----------------------------------------------------------------------------------------------------------------------
{%- endcomment -%}
{%- assign available_currencies = '' | split: ',' -%}
{%- for market in shop.enabled_markets -%}
  {%- unless available_currencies contains market.currency.iso_code -%}
    {%- assign available_currencies = available_currencies | append: market.currency.iso_code | split: ',' -%}
  {%- endunless -%}
{%- endfor -%}

<div class="relative">
  <button type="button" class="localization-toggle heading text-xxs link-faded" aria-controls="{{ currency_popover_id }}" aria-label="{{ 'general.localization.change_currency_accessibility_text' | t | escape }}" aria-expanded="false">
    <span>{{ cart.currency.iso_code }}{% if cart.currency.symbol %} {{ cart.currency.symbol }}{%- endif -%}</span>
    {%- render 'icon' with 'chevron-down' -%}
  </button>

  <x-popover id="{{ currency_popover_id }}" initial-focus="[aria-selected='true']" class="popover popover--{{ placement | default: 'bottom-start' }} color-scheme color-scheme--dialog">
    <p class="h4" slot="header">{{ 'general.localization.currency' | t }}</p>

    {%- form 'currency', id: currency_form_id -%}
      <x-listbox class="popover__value-list">
        {%- for market in shop.enabled_markets -%}
          {%- assign is_selected = false -%}
          {%- if market.currency.iso_code == cart.currency.iso_code -%}
            {%- assign is_selected = true -%}
          {%- endif -%}

          <button type="submit" name="currency_code" class="popover__value-option" role="option" value="{{ market.currency.iso_code }}" aria-selected="{% if is_selected %}true{% else %}false{% endif %}">
            <span>{{ market.currency.iso_code }}{% if market.currency.symbol %} {{ market.currency.symbol }}{%- endif -%}</span>
          </button>
        {%- endfor -%}
      </x-listbox>
    {%- endform -%}
  </x-popover>
</div>