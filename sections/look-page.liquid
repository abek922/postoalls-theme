<style>
  #shopify-section-{{ section.id }} {
    --look-page-navigation-height: 120px;
  }

  .look-page {
    position: relative;
  }

  .look-page__header {
    padding: 2rem 0;
    text-align: {{ section.settings.page_title_position }};
  }

  .look-page__navigation {
    position: sticky;
    top: calc(var(--sticky-area-height, 0px) + 1rem);
    z-index: 3;
    background: rgba(var(--background), 0.95);
    backdrop-filter: blur(10px);
    padding: 1rem 0;
    margin-bottom: 2rem;
    border-top: 1px solid rgba(var(--border-color), 0.1);
    border-bottom: 1px solid rgba(var(--border-color), 0.1);
  }

  .look-page__thumbnails {
    display: flex;
    gap: 1rem;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    max-width: 100%;
    overflow-x: auto;
    padding: 0 1rem;
  }

  .look-page__thumbnail {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    opacity: 0.7;
  }

  .look-page__thumbnail.is-active {
    border-color: rgb(var(--text-color));
    opacity: 1;
    transform: scale(1.05);
  }

  .look-page__thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .look-page__thumbnail:hover img {
    transform: scale(1.1);
  }

  .look-page__content {
    position: relative;
  }

  .look-page__look {
    display: none;
    grid-template-columns: 1fr;
    gap: 2rem;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .look-page__look.is-active {
    display: grid;
  }

  .look-page__image-container {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .look-page__image {
    max-width: 100%;
    height: auto;
    border-radius: 12px;
  }

  .look-page__nav-button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(var(--background), 0.9);
    border: 1px solid rgba(var(--border-color), 0.2);
    border-radius: 50%;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 2;
  }

  .look-page__nav-button:hover {
    background: rgb(var(--background));
    border-color: rgb(var(--border-color));
    transform: translateY(-50%) scale(1.1);
  }

  .look-page__nav-button--prev {
    left: 1rem;
  }

  .look-page__nav-button--next {
    right: 1rem;
  }

  .look-page__nav-button svg {
    width: 20px;
    height: 20px;
    fill: currentColor;
  }

  .look-page__products {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
  }

  .look-page__product-card {
    background: rgb(var(--background));
    border: 1px solid rgba(var(--border-color), 0.1);
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s ease;
    text-decoration: none;
    color: inherit;
  }

  .look-page__product-card:hover {
    border-color: rgba(var(--border-color), 0.3);
    transform: translateY(-2px);
    box-shadow: 0 8px 32px rgba(var(--text-color), 0.1);
  }

  .look-page__product-image {
    width: 100%;
    aspect-ratio: 1;
    object-fit: cover;
  }

  .look-page__product-info {
    padding: 1rem;
  }

  .look-page__product-title {
    font-size: 0.875rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
    line-height: 1.4;
  }

  .look-page__product-price {
    font-size: 0.875rem;
    color: rgba(var(--text-color), 0.7);
  }

  .look-page__look-title {
    text-align: center;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    font-weight: 400;
    letter-spacing: 0.05em;
  }

  @media screen and (min-width: 768px) {
    .look-page__look {
      grid-template-columns: 2fr 1fr;
      gap: 3rem;
    }

    .look-page__products {
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .look-page__thumbnail {
      width: 100px;
      height: 100px;
    }

    .look-page__nav-button {
      width: 56px;
      height: 56px;
    }
  }

  @media screen and (min-width: 1024px) {
    .look-page__products {
      grid-template-columns: repeat(3, 1fr);
    }
  }
</style>

<div class="look-page color-scheme color-scheme--{{ section.settings.color_scheme.id }}">
  {%- if section.settings.show_breadcrumb -%}
    <div class="container">
      {%- comment -%} breadcrumbが存在しない場合の代替実装 {%- endcomment -%}
      {% if templates['breadcrumb'] %}
        {%- render 'breadcrumb' -%}
      {% else %}
        <nav class="breadcrumb" aria-label="breadcrumb">
          <ol class="breadcrumb__list">
            <li class="breadcrumb__item">
              <a href="{{ routes.root_url }}" class="breadcrumb__link">Home</a>
            </li>
            <li class="breadcrumb__item breadcrumb__item--current" aria-current="page">
              {{ page.title }}
            </li>
          </ol>
        </nav>
      {% endif %}
    </div>
  {%- endif -%}

  <div class="look-page__header container">
    <h1 class="h2">{{ page.title }}</h1>
  </div>

  {%- assign looks_with_images = section.blocks | where: 'settings', 'image' -%}
  {%- assign valid_looks = '' | split: '' -%}
  {%- for block in section.blocks -%}
    {%- if block.settings.image != blank -%}
      {%- assign valid_looks = valid_looks | append: block -%}
    {%- endif -%}
  {%- endfor -%}

  {%- if valid_looks.size > 1 -%}
    <div class="look-page__navigation">
      <div class="look-page__thumbnails">
        {%- assign index = 0 -%}
        {%- for block in section.blocks -%}
          {%- if block.settings.image != blank -%}
            <div class="look-page__thumbnail {% if index == 0 %}is-active{% endif %}" 
                 data-look-index="{{ index }}" 
                 data-block-id="{{ block.id }}">
              {{ block.settings.image | image_url: width: 200 | image_tag: alt: block.settings.title, loading: 'lazy' }}
            </div>
            {%- assign index = index | plus: 1 -%}
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>
  {%- endif -%}

  <div class="look-page__content" id="look-page-content">
    {%- assign index = 0 -%}
    {%- for block in section.blocks -%}
      {%- if block.settings.image != blank -%}
        <div class="look-page__look {% if index == 0 %}is-active{% endif %}" 
             data-look-index="{{ index }}" 
             data-block-id="{{ block.id }}"
             {{ block.shopify_attributes }}>
          
          <div class="look-page__image-container">
            {%- if valid_looks.size > 1 -%}
              <button class="look-page__nav-button look-page__nav-button--prev" data-action="prev-look" type="button">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <button class="look-page__nav-button look-page__nav-button--next" data-action="next-look" type="button">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            {%- endif -%}
            
            {{ block.settings.image | image_url: width: 1200 | image_tag: class: 'look-page__image', alt: block.settings.title, loading: 'lazy' }}
          </div>

          <div class="look-page__sidebar">
            {%- if block.settings.title != blank -%}
              <h2 class="look-page__look-title">{{ block.settings.title }}</h2>
            {%- endif -%}

            <div class="look-page__products">
              {%- for i in (1..6) -%}
                {%- assign product_key = 'product_' | append: i -%}
                {%- assign product = all_products[block.settings[product_key]] -%}
                
                {%- if product and product != empty -%}
                  <a href="{{ product.url }}" class="look-page__product-card">
                    {%- if product.featured_image -%}
                      {{ product.featured_image | image_url: width: 400 | image_tag: class: 'look-page__product-image', alt: product.title, loading: 'lazy' }}
                    {%- else -%}
                      <div class="look-page__product-image placeholder">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                          <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                          <circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="2"/>
                          <path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                    {%- endif -%}
                    
                    <div class="look-page__product-info">
                      <h3 class="look-page__product-title">{{ product.title }}</h3>
                      <div class="look-page__product-price">
                        {%- if product.compare_at_price > product.price -%}
                          <span class="price price--compare">{{ product.compare_at_price | money }}</span>
                        {%- endif -%}
                        <span class="price">{{ product.price | money }}</span>
                      </div>
                    </div>
                  </a>
                {%- endif -%}
              {%- endfor -%}
            </div>
          </div>
        </div>
        {%- assign index = index | plus: 1 -%}
      {%- endif -%}
    {%- endfor -%}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const lookPageContent = document.getElementById('look-page-content');
  if (!lookPageContent) return;

  let currentIndex = 0;
  const looks = Array.from(lookPageContent.querySelectorAll('.look-page__look'));
  const thumbnails = Array.from(document.querySelectorAll('.look-page__thumbnail'));
  const prevButtons = Array.from(document.querySelectorAll('[data-action="prev-look"]'));
  const nextButtons = Array.from(document.querySelectorAll('[data-action="next-look"]'));

  function showLook(index) {
    if (index < 0 || index >= looks.length) return;

    currentIndex = index;

    // LOOKの表示切り替え
    looks.forEach((look, i) => {
      if (i === index) {
        look.classList.add('is-active');
        look.style.display = 'grid';
      } else {
        look.classList.remove('is-active');
        look.style.display = 'none';
      }
    });

    // サムネイルのアクティブ状態切り替え
    thumbnails.forEach((thumbnail, i) => {
      if (i === index) {
        thumbnail.classList.add('is-active');
      } else {
        thumbnail.classList.remove('is-active');
      }
    });

    // アクティブなサムネイルを表示範囲内にスクロール
    if (thumbnails[index]) {
      thumbnails[index].scrollIntoView({
        behavior: 'smooth',
        block: 'nearest',
        inline: 'center'
      });
    }
  }

  function showPreviousLook() {
    const newIndex = currentIndex > 0 ? currentIndex - 1 : looks.length - 1;
    showLook(newIndex);
  }

  function showNextLook() {
    const newIndex = currentIndex < looks.length - 1 ? currentIndex + 1 : 0;
    showLook(newIndex);
  }

  // サムネイルクリックイベント
  thumbnails.forEach((thumbnail, index) => {
    thumbnail.addEventListener('click', function() {
      showLook(index);
    });
  });

  // ナビゲーションボタンイベント
  prevButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      showPreviousLook();
    });
  });

  nextButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      showNextLook();
    });
  });

  // キーボードナビゲーション
  document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft') {
      showPreviousLook();
    } else if (e.key === 'ArrowRight') {
      showNextLook();
    }
  });

  // 初期化
  showLook(0);
});
</script>

{% schema %}
{
  "name": "Look Page",
  "class": "shopify-section--look-page",
  "tag": "section",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "checkbox",
      "id": "show_breadcrumb",
      "label": "Show breadcrumb",
      "default": true
    },
    {
      "type": "select",
      "id": "page_title_position",
      "label": "Page title position",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    }
  ],
  "blocks": [
    {
      "type": "look",
      "name": "Look",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Look Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Look Title",
          "default": "LOOK 01"
        },
        {
          "type": "product",
          "id": "product_1",
          "label": "Product 1"
        },
        {
          "type": "product",
          "id": "product_2",
          "label": "Product 2"
        },
        {
          "type": "product",
          "id": "product_3",
          "label": "Product 3"
        },
        {
          "type": "product",
          "id": "product_4",
          "label": "Product 4"
        },
        {
          "type": "product",
          "id": "product_5",
          "label": "Product 5"
        },
        {
          "type": "product",
          "id": "product_6",
          "label": "Product 6"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Look Page",
      "blocks": [
        {
          "type": "look"
        }
      ]
    }
  ]
}
{% endschema %}