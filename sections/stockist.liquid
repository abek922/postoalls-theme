{% comment %}
  Stockist Section
  取扱店舗一覧セクション
{% endcomment %}

{%- style -%}
  .stockist-section {
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
    background-color: {{ section.settings.background_color }};
  }

  .stockist-container {
    max-width: {{ section.settings.container_width }}px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .stockist-header {
    text-align: center;
    margin-bottom: {{ section.settings.header_margin_bottom }}px;
  }

  .stockist-title {
    font-size: {{ section.settings.title_font_size }}px;
    font-weight: {{ section.settings.title_font_weight }};
    color: {{ section.settings.title_color }};
    letter-spacing: {{ section.settings.title_letter_spacing }}px;
    margin-bottom: 20px;
  }

  .stockist-description {
    font-size: {{ section.settings.description_font_size }}px;
    color: {{ section.settings.description_color }};
    line-height: 1.6;
    max-width: 800px;
    margin: 0 auto;
  }

  .stockist-tabs {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: {{ section.settings.tabs_margin_bottom }}px;
    border-bottom: 1px solid {{ section.settings.tab_border_color }};
  }

  .stockist-tab {
    padding: 12px 24px;
    font-size: {{ section.settings.tab_font_size }}px;
    color: {{ section.settings.tab_color }};
    background: none;
    border: none;
    cursor: pointer;
    position: relative;
    transition: all 0.3s ease;
    font-weight: {{ section.settings.tab_font_weight }};
    letter-spacing: 0.5px;
  }

  .stockist-tab:hover {
    color: {{ section.settings.tab_active_color }};
  }

  .stockist-tab.active {
    color: {{ section.settings.tab_active_color }};
  }

  .stockist-tab.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
    height: 2px;
    background-color: {{ section.settings.tab_active_color }};
  }

  .stockist-content {
    display: none;
  }

  .stockist-content.active {
    display: block;
  }

  .stockist-grid {
    display: grid;
    grid-template-columns: repeat({{ section.settings.columns_desktop }}, 1fr);
    gap: {{ section.settings.grid_gap }}px;
    margin-bottom: 40px;
  }

  .stockist-region {
    margin-bottom: 40px;
  }

  .stockist-region-title {
    font-size: {{ section.settings.region_title_font_size }}px;
    font-weight: {{ section.settings.region_title_font_weight }};
    color: {{ section.settings.region_title_color }};
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid {{ section.settings.region_border_color }};
  }

  .stockist-area {
    margin-bottom: 30px;
  }

  .stockist-area-title {
    font-size: {{ section.settings.area_title_font_size }}px;
    font-weight: {{ section.settings.area_title_font_weight }};
    color: {{ section.settings.area_title_color }};
    margin-bottom: 15px;
    display: flex;
    align-items: center;
  }

  .stockist-area-title::before {
    content: '';
    display: inline-block;
    width: 4px;
    height: 16px;
    background-color: {{ section.settings.area_accent_color }};
    margin-right: 10px;
  }

  .stockist-stores {
    display: grid;
    grid-template-columns: repeat({{ section.settings.stores_columns }}, 1fr);
    gap: 20px;
  }

  .stockist-store {
    padding: 20px;
    background-color: {{ section.settings.store_background_color }};
    border: 1px solid {{ section.settings.store_border_color }};
    transition: all 0.3s ease;
  }

  .stockist-store:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transform: translateY(-2px);
  }

  .stockist-store-name {
    font-size: {{ section.settings.store_name_font_size }}px;
    font-weight: {{ section.settings.store_name_font_weight }};
    color: {{ section.settings.store_name_color }};
    margin-bottom: 8px;
  }

  .stockist-store-details {
    font-size: {{ section.settings.store_details_font_size }}px;
    color: {{ section.settings.store_details_color }};
    line-height: 1.5;
  }

  .stockist-store-link {
    display: inline-block;
    margin-top: 10px;
    font-size: {{ section.settings.store_link_font_size }}px;
    color: {{ section.settings.store_link_color }};
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .stockist-store-link:hover {
    color: {{ section.settings.store_link_hover_color }};
    text-decoration: underline;
  }

  .stockist-inquiry {
    text-align: center;
    margin-top: 60px;
    padding: 40px;
    background-color: {{ section.settings.inquiry_background_color }};
  }

  .stockist-inquiry-title {
    font-size: {{ section.settings.inquiry_title_font_size }}px;
    font-weight: {{ section.settings.inquiry_title_font_weight }};
    color: {{ section.settings.inquiry_title_color }};
    margin-bottom: 15px;
  }

  .stockist-inquiry-text {
    font-size: {{ section.settings.inquiry_text_font_size }}px;
    color: {{ section.settings.inquiry_text_color }};
    margin-bottom: 20px;
  }

  .stockist-inquiry-button {
    display: inline-block;
    padding: 12px 30px;
    background-color: {{ section.settings.inquiry_button_background }};
    color: {{ section.settings.inquiry_button_color }};
    text-decoration: none;
    font-size: {{ section.settings.inquiry_button_font_size }}px;
    font-weight: {{ section.settings.inquiry_button_font_weight }};
    transition: all 0.3s ease;
  }

  .stockist-inquiry-button:hover {
    background-color: {{ section.settings.inquiry_button_hover_background }};
    color: {{ section.settings.inquiry_button_hover_color }};
  }

  @media screen and (max-width: 768px) {
    .stockist-grid {
      grid-template-columns: repeat({{ section.settings.columns_mobile }}, 1fr);
    }

    .stockist-stores {
      grid-template-columns: 1fr;
    }

    .stockist-tabs {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .stockist-title {
      font-size: calc({{ section.settings.title_font_size }}px * 0.8);
    }
  }
{%- endstyle -%}

<section class="stockist-section">
  <div class="stockist-container">
    {% if section.settings.show_header %}
      <div class="stockist-header">
        <h2 class="stockist-title">{{ section.settings.title }}</h2>
        {% if section.settings.description != blank %}
          <p class="stockist-description">{{ section.settings.description }}</p>
        {% endif %}
      </div>
    {% endif %}

    {% if section.settings.enable_tabs %}
      <div class="stockist-tabs">
        {% for block in section.blocks %}
          {% if block.type == 'tab' %}
            <button class="stockist-tab {% if forloop.first %}active{% endif %}" data-tab="{{ block.id }}">
              {{ block.settings.tab_title }}
            </button>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}

    {% for block in section.blocks %}
      {% case block.type %}
        {% when 'tab' %}
          <div class="stockist-content {% if forloop.first %}active{% endif %}" data-content="{{ block.id }}">
            {% if block.settings.enable_regions %}
              {% for i in (1..5) %}
                {% assign region_title = 'region_' | append: i | append: '_title' %}
                {% assign region_areas = 'region_' | append: i | append: '_areas' %}
                
                {% if block.settings[region_title] != blank %}
                  <div class="stockist-region">
                    <h3 class="stockist-region-title">{{ block.settings[region_title] }}</h3>
                    
                    {% assign areas = block.settings[region_areas] | split: '||' %}
                    {% for area in areas %}
                      {% assign area_parts = area | split: '::' %}
                      {% if area_parts.size > 0 %}
                        <div class="stockist-area">
                          <h4 class="stockist-area-title">{{ area_parts[0] }}</h4>
                          
                          <div class="stockist-stores">
                            {% if area_parts.size > 1 %}
                              {% assign stores = area_parts[1] | split: ';;' %}
                              {% for store in stores %}
                                {% assign store_info = store | split: '|' %}
                                {% if store_info.size > 0 %}
                                  <div class="stockist-store">
                                    <h5 class="stockist-store-name">{{ store_info[0] }}</h5>
                                    {% if store_info.size > 1 %}
                                      <div class="stockist-store-details">
                                        {{ store_info[1] | newline_to_br }}
                                      </div>
                                    {% endif %}
                                    {% if store_info.size > 2 and store_info[2] != blank %}
                                      <a href="{{ store_info[2] }}" class="stockist-store-link" target="_blank">
                                        {{ section.settings.store_link_text }}
                                      </a>
                                    {% endif %}
                                  </div>
                                {% endif %}
                              {% endfor %}
                            {% endif %}
                          </div>
                        </div>
                      {% endif %}
                    {% endfor %}
                  </div>
                {% endif %}
              {% endfor %}
            {% else %}
              <div class="stockist-grid">
                {% for i in (1..20) %}
                  {% assign store_name = 'store_' | append: i | append: '_name' %}
                  {% assign store_details = 'store_' | append: i | append: '_details' %}
                  {% assign store_link = 'store_' | append: i | append: '_link' %}
                  
                  {% if block.settings[store_name] != blank %}
                    <div class="stockist-store">
                      <h5 class="stockist-store-name">{{ block.settings[store_name] }}</h5>
                      {% if block.settings[store_details] != blank %}
                        <div class="stockist-store-details">
                          {{ block.settings[store_details] | newline_to_br }}
                        </div>
                      {% endif %}
                      {% if block.settings[store_link] != blank %}
                        <a href="{{ block.settings[store_link] }}" class="stockist-store-link" target="_blank">
                          {{ section.settings.store_link_text }}
                        </a>
                      {% endif %}
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
            {% endif %}
          </div>
        {% when 'inquiry' %}
          <div class="stockist-inquiry">
            <h3 class="stockist-inquiry-title">{{ block.settings.inquiry_title }}</h3>
            <p class="stockist-inquiry-text">{{ block.settings.inquiry_text }}</p>
            <a href="{{ block.settings.inquiry_link }}" class="stockist-inquiry-button">
              {{ block.settings.inquiry_button_text }}
            </a>
          </div>
      {% endcase %}
    {% endfor %}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.stockist-tab');
    const contents = document.querySelectorAll('.stockist-content');
    
    tabs.forEach(tab => {
      tab.addEventListener('click', function() {
        const tabId = this.getAttribute('data-tab');
        
        // Remove active class from all tabs and contents
        tabs.forEach(t => t.classList.remove('active'));
        contents.forEach(c => c.classList.remove('active'));
        
        // Add active class to clicked tab and corresponding content
        this.classList.add('active');
        document.querySelector(`[data-content="${tabId}"]`).classList.add('active');
      });
    });
  });
</script>

{% schema %}
{
  "name": "Stockist",
  "tag": "section",
  "class": "stockist-section",
  "settings": [
    {
      "type": "header",
      "content": "基本設定"
    },
    {
      "type": "checkbox",
      "id": "show_header",
      "label": "ヘッダーを表示",
      "default": true
    },
    {
      "type": "text",
      "id": "title",
      "label": "タイトル",
      "default": "STOCKIST"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "説明文",
      "default": "私たちの製品を取り扱っている店舗をご紹介します。"
    },
    {
      "type": "checkbox",
      "id": "enable_tabs",
      "label": "タブ機能を有効化",
      "default": true
    },
    {
      "type": "header",
      "content": "レイアウト"
    },
    {
      "type": "range",
      "id": "container_width",
      "label": "コンテナ幅",
      "min": 800,
      "max": 1600,
      "step": 100,
      "unit": "px",
      "default": 1200
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "上部余白",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "下部余白",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 60
    },
    {
      "type": "select",
      "id": "columns_desktop",
      "label": "デスクトップ列数",
      "options": [
        {
          "value": "1",
          "label": "1列"
        },
        {
          "value": "2",
          "label": "2列"
        },
        {
          "value": "3",
          "label": "3列"
        },
        {
          "value": "4",
          "label": "4列"
        }
      ],
      "default": "3"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "モバイル列数",
      "options": [
        {
          "value": "1",
          "label": "1列"
        },
        {
          "value": "2",
          "label": "2列"
        }
      ],
      "default": "1"
    },
    {
      "type": "range",
      "id": "grid_gap",
      "label": "グリッド間隔",
      "min": 10,
      "max": 50,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "select",
      "id": "stores_columns",
      "label": "店舗列数",
      "options": [
        {
          "value": "1",
          "label": "1列"
        },
        {
          "value": "2",
          "label": "2列"
        },
        {
          "value": "3",
          "label": "3列"
        }
      ],
      "default": "2"
    },
    {
      "type": "header",
      "content": "色設定"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "背景色",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "タイトル色",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "説明文色",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "tab_color",
      "label": "タブ色",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "tab_active_color",
      "label": "アクティブタブ色",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "tab_border_color",
      "label": "タブボーダー色",
      "default": "#e0e0e0"
    },
    {
      "type": "color",
      "id": "region_title_color",
      "label": "地域タイトル色",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "region_border_color",
      "label": "地域ボーダー色",
      "default": "#e0e0e0"
    },
    {
      "type": "color",
      "id": "area_title_color",
      "label": "エリアタイトル色",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "area_accent_color",
      "label": "エリアアクセント色",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "store_background_color",
      "label": "店舗背景色",
      "default": "#f8f8f8"
    },
    {
      "type": "color",
      "id": "store_border_color",
      "label": "店舗ボーダー色",
      "default": "#e0e0e0"
    },
    {
      "type": "color",
      "id": "store_name_color",
      "label": "店舗名色",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "store_details_color",
      "label": "店舗詳細色",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "store_link_color",
      "label": "店舗リンク色",
      "default": "#0066cc"
    },
    {
      "type": "color",
      "id": "store_link_hover_color",
      "label": "店舗リンクホバー色",
      "default": "#0052a3"
    },
    {
      "type": "header",
      "content": "フォント設定"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "label": "タイトルフォントサイズ",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "default": 36
    },
    {
      "type": "select",
      "id": "title_font_weight",
      "label": "タイトルフォントウェイト",
      "options": [
        {
          "value": "300",
          "label": "細い"
        },
        {
          "value": "400",
          "label": "標準"
        },
        {
          "value": "500",
          "label": "中"
        },
        {
          "value": "600",
          "label": "太い"
        },
        {
          "value": "700",
          "label": "より太い"
        }
      ],
      "default": "600"
    },
    {
      "type": "range",
      "id": "title_letter_spacing",
      "label": "タイトル文字間隔",
      "min": 0,
      "max": 5,
      "step": 0.5,
      "unit": "px",
      "default": 2
    },
    {
      "type": "range",
      "id": "description_font_size",
      "label": "説明文フォントサイズ",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "tab_font_size",
      "label": "タブフォントサイズ",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "select",
      "id": "tab_font_weight",
      "label": "タブフォントウェイト",
      "options": [
        {
          "value": "400",
          "label": "標準"
        },
        {
          "value": "500",
          "label": "中"
        },
        {
          "value": "600",
          "label": "太い"
        }
      ],
      "default": "500"
    },
    {
      "type": "range",
      "id": "region_title_font_size",
      "label": "地域タイトルフォントサイズ",
      "min": 16,
      "max": 30,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "select",
      "id": "region_title_font_weight",
      "label": "地域タイトルフォントウェイト",
      "options": [
        {
          "value": "400",
          "label": "標準"
        },
        {
          "value": "500",
          "label": "中"
        },
        {
          "value": "600",
          "label": "太い"
        }
      ],
      "default": "600"
    },
    {
      "type": "range",
      "id": "area_title_font_size",
      "label": "エリアタイトルフォントサイズ",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 18
    },
    {
      "type": "select",
      "id": "area_title_font_weight",
      "label": "エリアタイトルフォントウェイト",
      "options": [
        {
          "value": "400",
          "label": "標準"
        },
        {
          "value": "500",
          "label": "中"
        },
        {
          "value": "600",
          "label": "太い"
        }
      ],
      "default": "500"
    },
    {
      "type": "range",
      "id": "store_name_font_size",
      "label": "店舗名フォントサイズ",
      "min": 14,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "select",
      "id": "store_name_font_weight",
      "label": "店舗名フォントウェイト",
      "options": [
        {
          "value": "400",
          "label": "標準"
        },
        {
          "value": "500",
          "label": "中"
        },
        {
          "value": "600",
          "label": "太い"
        }
      ],
      "default": "600"
    },
    {
      "type": "range",
      "id": "store_details_font_size",
      "label": "店舗詳細フォントサイズ",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "range",
      "id": "store_link_font_size",
      "label": "店舗リンクフォントサイズ",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "text",
      "id": "store_link_text",
      "label": "店舗リンクテキスト",
      "default": "詳細を見る"
    },
    {
      "type": "header",
      "content": "お問い合わせセクション"
    },
    {
      "type": "color",
      "id": "inquiry_background_color",
      "label": "お問い合わせ背景色",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "inquiry_title_color",
      "label": "お問い合わせタイトル色",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "inquiry_text_color",
      "label": "お問い合わせテキスト色",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "inquiry_button_background",
      "label": "ボタン背景色",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "inquiry_button_color",
      "label": "ボタンテキスト色",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "inquiry_button_hover_background",
      "label": "ボタンホバー背景色",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "inquiry_button_hover_color",
      "label": "ボタンホバーテキスト色",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "inquiry_title_font_size",
      "label": "お問い合わせタイトルサイズ",
      "min": 16,
      "max": 30,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "select",
      "id": "inquiry_title_font_weight",
      "label": "お問い合わせタイトルウェイト",
      "options": [
        {
          "value": "400",
          "label": "標準"
        },
        {
          "value": "500",
          "label": "中"
        },
        {
          "value": "600",
          "label": "太い"
        }
      ],
      "default": "600"
    },
    {
      "type": "range",
      "id": "inquiry_text_font_size",
      "label": "お問い合わせテキストサイズ",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "inquiry_button_font_size",
      "label": "ボタンフォントサイズ",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "select",
      "id": "inquiry_button_font_weight",
      "label": "ボタンフォントウェイト",
      "options": [
        {
          "value": "400",
          "label": "標準"
        },
        {
          "value": "500",
          "label": "中"
        },
        {
          "value": "600",
          "label": "太い"
        }
      ],
      "default